{% extends "base.html" %}

{% block title %}Emergency Repair Details - Step 3: Device Information - Fixbulance{% endblock %}

{% block styles %}
<style>
    .booking-container {
        min-height: 70vh;
        background: linear-gradient(135deg, rgba(227, 232, 216, 0.1) 0%, rgba(30, 58, 95, 0.05) 100%);
        padding: 3rem 0;
    }
    
    .booking-card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        overflow: hidden;
    }
    
    .booking-header {
        background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
        color: var(--white);
        padding: 2rem;
        text-align: center;
        border: none;
    }
    
    .booking-header h4 {
        color: var(--white);
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .emergency-badge {
        background-color: var(--red);
        color: var(--white);
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.875rem;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 1rem;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
        100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
    }
    
    .progress-bar-container {
        margin: 2rem 0;
    }
    
    .custom-progress {
        height: 8px;
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .custom-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--red), #ff4757);
        width: 50%; /* 3/6 steps */
        transition: width 0.3s ease;
    }
    
    .selections-summary {
        background: linear-gradient(135deg, #10b981, #059669);
        color: var(--white);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .form-section {
        padding: 2.5rem;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--dark-navy);
        margin-bottom: 0.5rem;
    }
    
    .form-control, .form-select {
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s ease;
    }
    
    .form-control:focus, .form-select:focus {
        outline: none;
        border-color: var(--navy);
        box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
    }
    
    .section-header {
        color: var(--navy);
        font-weight: 700;
        font-size: 1.2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--light-gray);
    }
    
    .emergency-info {
        background: rgba(220, 38, 38, 0.1);
        border-left: 4px solid var(--red);
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .step-navigation {
        padding: 1.5rem 2.5rem;
        background: var(--light-gray);
        border-top: 1px solid #e2e8f0;
    }
    
    .photo-upload-area {
        border: 2px dashed #cbd5e0;
        border-radius: 12px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .photo-upload-area:hover {
        border-color: var(--navy);
        background: rgba(30, 58, 95, 0.05);
    }
    
    .photo-upload-area.dragover {
        border-color: var(--red);
        background: rgba(220, 38, 38, 0.05);
    }
    
    @media (max-width: 768px) {
        .booking-container {
            padding: 1rem 0;
        }
        
        .form-section {
            padding: 1.5rem;
        }
        
        .step-navigation {
            padding: 1rem 1.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="booking-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card booking-card">
                    <div class="card-header booking-header">
                        <div class="emergency-badge">
                            <i class="fas fa-ambulance me-1"></i>
                            Emergency Diagnostic Details
                        </div>
                        <h4>Device Information & Problem Details</h4>
                        <p class="mb-0 opacity-90">Step 3 of 6: Help us prepare for your emergency repair</p>
                        
                        <div class="progress-bar-container">
                            <div class="custom-progress">
                                <div class="custom-progress-bar"></div>
                            </div>
                            <small class="text-white-50">Step 3: Device Details & Problem Description</small>
                        </div>
                    </div>

                    <!-- Previous Selections Summary -->
                    <div class="selections-summary">
                        <h6 class="mb-3">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>Emergency Service Summary</strong>
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-mobile-alt me-2"></i>
                                    <strong>Device:</strong>&nbsp;{{ device_type }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-tools me-2"></i>
                                    <strong>Emergency Service:</strong>&nbsp;{{ service.name }}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <small class="opacity-90">
                                    <i class="fas fa-clock me-1"></i>
                                    Estimated Time: {{ service.estimated_time }}min
                                </small>
                            </div>
                            <div class="col-md-6">
                                <small class="opacity-90">
                                    <i class="fas fa-dollar-sign me-1"></i>
                                    Emergency Deposit: ${{ "%.2f"|format(service.deposit_amount) }}
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <form method="POST" action="{{ url_for('booking.step4_location') }}" enctype="multipart/form-data" id="detailsForm">
                        <input type="hidden" name="device_type" value="{{ device_type }}">
                        <input type="hidden" name="service_id" value="{{ service.id }}">
                        
                        <div class="form-section">
                            <!-- Device Information Section -->
                            <h5 class="section-header">
                                <i class="fas fa-mobile-alt me-2"></i>Emergency Device Information
                            </h5>
                            
                            <div class="row">
                                <!-- Device Model -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="device_model" class="form-label">
                                            <i class="fas fa-info-circle me-1"></i>Device Model *
                                        </label>
                                        {% if device_type == 'iPhone' %}
                                            <select class="form-select" id="device_model" name="device_model" required>
                                                <option value="">Select iPhone Model</option>
                                                <option value="iPhone 15 Pro Max">iPhone 15 Pro Max</option>
                                                <option value="iPhone 15 Pro">iPhone 15 Pro</option>
                                                <option value="iPhone 15 Plus">iPhone 15 Plus</option>
                                                <option value="iPhone 15">iPhone 15</option>
                                                <option value="iPhone 14 Pro Max">iPhone 14 Pro Max</option>
                                                <option value="iPhone 14 Pro">iPhone 14 Pro</option>
                                                <option value="iPhone 14 Plus">iPhone 14 Plus</option>
                                                <option value="iPhone 14">iPhone 14</option>
                                                <option value="iPhone 13 Pro Max">iPhone 13 Pro Max</option>
                                                <option value="iPhone 13 Pro">iPhone 13 Pro</option>
                                                <option value="iPhone 13 Mini">iPhone 13 Mini</option>
                                                <option value="iPhone 13">iPhone 13</option>
                                                <option value="iPhone 12 Pro Max">iPhone 12 Pro Max</option>
                                                <option value="iPhone 12 Pro">iPhone 12 Pro</option>
                                                <option value="iPhone 12 Mini">iPhone 12 Mini</option>
                                                <option value="iPhone 12">iPhone 12</option>
                                                <option value="iPhone 11 Pro Max">iPhone 11 Pro Max</option>
                                                <option value="iPhone 11 Pro">iPhone 11 Pro</option>
                                                <option value="iPhone 11">iPhone 11</option>
                                                <option value="iPhone XS Max">iPhone XS Max</option>
                                                <option value="iPhone XS">iPhone XS</option>
                                                <option value="iPhone XR">iPhone XR</option>
                                                <option value="iPhone X">iPhone X</option>
                                                <option value="iPhone 8 Plus">iPhone 8 Plus</option>
                                                <option value="iPhone 8">iPhone 8</option>
                                                <option value="iPhone 7 Plus">iPhone 7 Plus</option>
                                                <option value="iPhone 7">iPhone 7</option>
                                                <option value="iPhone 6s Plus">iPhone 6s Plus</option>
                                                <option value="iPhone 6s">iPhone 6s</option>
                                                <option value="iPhone 6 Plus">iPhone 6 Plus</option>
                                                <option value="iPhone 6">iPhone 6</option>
                                            </select>
                                        {% elif device_type == 'Samsung' %}
                                            <select class="form-select" id="device_model" name="device_model" required>
                                                <option value="">Select Samsung Model</option>
                                                <option value="Galaxy S24 Ultra">Galaxy S24 Ultra</option>
                                                <option value="Galaxy S24+">Galaxy S24+</option>
                                                <option value="Galaxy S24">Galaxy S24</option>
                                                <option value="Galaxy S23 Ultra">Galaxy S23 Ultra</option>
                                                <option value="Galaxy S23+">Galaxy S23+</option>
                                                <option value="Galaxy S23">Galaxy S23</option>
                                                <option value="Galaxy S22 Ultra">Galaxy S22 Ultra</option>
                                                <option value="Galaxy S22+">Galaxy S22+</option>
                                                <option value="Galaxy S22">Galaxy S22</option>
                                                <option value="Galaxy S21 Ultra">Galaxy S21 Ultra</option>
                                                <option value="Galaxy S21+">Galaxy S21+</option>
                                                <option value="Galaxy S21">Galaxy S21</option>
                                                <option value="Galaxy Note 20 Ultra">Galaxy Note 20 Ultra</option>
                                                <option value="Galaxy Note 20">Galaxy Note 20</option>
                                                <option value="Galaxy Note 10+">Galaxy Note 10+</option>
                                                <option value="Galaxy Note 10">Galaxy Note 10</option>
                                                <option value="Galaxy A54">Galaxy A54</option>
                                                <option value="Galaxy A34">Galaxy A34</option>
                                                <option value="Galaxy A24">Galaxy A24</option>
                                                <option value="Galaxy A14">Galaxy A14</option>
                                                <option value="Other Samsung Model">Other Samsung Model</option>
                                            </select>
                                        {% else %}
                                            <input type="text" class="form-control" id="device_model" name="device_model" 
                                                   placeholder="e.g. Google Pixel 8, OnePlus 12, etc." required>
                                        {% endif %}
                                        <div class="form-text">Select your exact device model for emergency repair preparation</div>
                                    </div>
                                </div>
                                
                                <!-- Storage Capacity -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="storage_capacity" class="form-label">
                                            <i class="fas fa-hdd me-1"></i>Storage Capacity
                                        </label>
                                        <select class="form-select" id="storage_capacity" name="storage_capacity">
                                            <option value="">Unknown/Not Sure</option>
                                            <option value="64GB">64GB</option>
                                            <option value="128GB">128GB</option>
                                            <option value="256GB">256GB</option>
                                            <option value="512GB">512GB</option>
                                            <option value="1TB">1TB</option>
                                            <option value="2TB">2TB</option>
                                        </select>
                                        <div class="form-text">Check in Settings > General > About if unsure</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <!-- Device Color -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="device_color" class="form-label">
                                            <i class="fas fa-palette me-1"></i>Device Color
                                        </label>
                                        <input type="text" class="form-control" id="device_color" name="device_color" 
                                               placeholder="e.g. Space Gray, Gold, Blue, etc.">
                                        <div class="form-text">Helps us identify your device during emergency service</div>
                                    </div>
                                </div>
                                
                                <!-- Purchase Date -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="purchase_date" class="form-label">
                                            <i class="fas fa-calendar me-1"></i>Approximate Purchase Date
                                        </label>
                                        <input type="month" class="form-control" id="purchase_date" name="purchase_date">
                                        <div class="form-text">Helps assess warranty status and part availability</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Emergency Problem Description Section -->
                            <h5 class="section-header mt-4">
                                <i class="fas fa-search me-2"></i>Emergency Problem Description
                            </h5>
                            
                            <div class="emergency-info">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Emergency Diagnostic Help:</strong> The more details you provide, the better we can prepare for your emergency repair and potentially resolve the issue faster.
                            </div>

                            <!-- Issue Description Text -->
                            <div class="mb-4">
                                <label for="issue_description" class="form-label">
                                    <i class="fas fa-comment-alt me-1"></i>Describe the Problem *
                                </label>
                                <textarea class="form-control" id="issue_description" name="issue_description" rows="4" 
                                          placeholder="Please describe what happened to your device, when the problem started, and any symptoms you've noticed..." required></textarea>
                                <div class="form-text">
                                    Include details like: When did it start? What were you doing? Any error messages? Physical damage visible?
                                </div>
                            </div>

                            <!-- Photo Upload Section -->
                            <div class="mb-4">
                                <label class="form-label">
                                    <i class="fas fa-camera me-1"></i>Emergency Diagnostic Photos (Optional)
                                </label>
                                <div class="photo-upload-area" onclick="document.getElementById('damage_photos').click()">
                                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--navy); margin-bottom: 1rem;"></i>
                                    <h6>Upload Photos of Damage or Issue</h6>
                                    <p class="text-muted mb-0">
                                        Click here or drag photos to help our emergency technicians prepare<br>
                                        <small>Supports: JPG, PNG, HEIC (Max 10MB each, up to 5 photos)</small>
                                    </p>
                                </div>
                                <input type="file" id="damage_photos" name="damage_photos" multiple 
                                       accept="image/*,.heic" style="display: none;" onchange="handlePhotoUpload(this)">
                                <div id="photoPreview" class="mt-3"></div>
                            </div>

                            <!-- Previous Attempts -->
                            <div class="mb-4">
                                <label for="previous_attempts" class="form-label">
                                    <i class="fas fa-history me-1"></i>Previous Repair Attempts
                                </label>
                                <textarea class="form-control" id="previous_attempts" name="previous_attempts" rows="2" 
                                          placeholder="Have you tried any DIY fixes or taken this to another repair shop? Let us know what was attempted..."></textarea>
                                <div class="form-text">This helps us avoid duplicate efforts and understand the device's history</div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{{ url_for('booking.step2_service', device_type=device_type) }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>Back to Service Selection
                                </a>
                                
                                <div class="text-center">
                                    <small class="text-muted">Emergency diagnostic information</small>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    Continue to Location <i class="fas fa-arrow-right ms-2"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Emergency Tips -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-lightbulb me-2 text-warning"></i>
                                    Emergency Diagnostic Tips
                                </h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2">
                                        <i class="fas fa-camera text-primary me-2"></i>
                                        <strong>Photos Help:</strong> Clear images of damage speed up diagnosis
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-list text-primary me-2"></i>
                                        <strong>Be Specific:</strong> Exact symptoms help us bring right parts
                                    </li>
                                    <li class="mb-0">
                                        <i class="fas fa-clock text-primary me-2"></i>
                                        <strong>Timeline:</strong> When the problem started affects repair approach
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-shield-alt me-2 text-success"></i>
                                    Emergency Service Preparation
                                </h6>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-0">
                                    <li class="mb-2">
                                        <i class="fas fa-tools text-success me-2"></i>
                                        <strong>Tools Ready:</strong> We bring everything needed for your repair
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-database text-success me-2"></i>
                                        <strong>Data Safety:</strong> Your information is always protected
                                    </li>
                                    <li class="mb-0">
                                        <i class="fas fa-stopwatch text-success me-2"></i>
                                        <strong>Quick Service:</strong> Emergency response within hours
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 